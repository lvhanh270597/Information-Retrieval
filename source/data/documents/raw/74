Luồng trong mạng IV: Ứng dụng của luồng -- Network Flow IV: Flow Applications
http://www.giaithuatlaptrinh.com/?p=1617
Nơi tổng hợp và chia sẻ những kiến thức liên quan tới giải thuật nói chung và lý thuyết khoa học máy tính nói riêng.   in  | Trong bài này, chúng ta sẽ tìm hiểu ba ứng dụng khác nhau của luồng:Ba ứng dụng này nằm trong ba lĩnh vực hoàn toàn khác nhau cho chúng ta thấy bài toán luồng cực đại có tiềm năng ứng dụng rất lớn.Một đồ thị  được gọi là  (bipartitie) nếu tồn tại một cách phân hoạch tập đỉnh  thành hai phần  và  sao cho mỗi cạnh có đúng một đầu mút trong  và một đầu mút trong . Xem ví dụ trong Figure 1 (a). Ta thường sử dụng kí hiệu  để kí hiệu đồ thị hai phía.
 (a) Một đồ thị hai phía và một cặp ghép trong đồ thị (b) Cặp ghép cực đại của đồ thị (c) Mạng thu được từ đồ thị ở hình (a), các cạnh vô hướng sẽ được chuyển thành hai cạnh có hướng song song ngược chiều với khả năng thông qua .Cho trước một đồ thị, ta có thể kiểm tra đồ thị đó có phải là hai phía hay không trong thời gian  bằng . Trong giới hạn của bài viết, ta sẽ không đi sau vào chi tiết thuật toán này. Về cơ bản, thuật toán dựa trên nhận xét rằng một đồ thị là hai phía khi và chỉ khi nó không chứa chu trình lẻ (odd cycle), i.e, chu trình mà số đỉnh thuộc chu trình là một số lẻ.Một  (matching) trong một đồ thị (không nhất thiết là hai phía) là một tập các cạnh  sao cho không có hai cạnh  nào trong  có chung một đầu mút. Một cặp ghép được gọi là cực đại  (maximum matching)  nếu nó có kích thước (số lượng cạnh) lớn nhất trong số các cặp ghép khác nhau của đồ thị. Xem ví dụ tring Figure 1(c). Bài toán đặt ra cho chúng ta là tìm một cặp ghép cực đại trong đồ thị hai phía .Chúng ta sẽ quy bài toán này về bài toán luồng cực đại như sau: ta định hướng các các cạnh vô hướng thành các cung từ  đến  và gán cho mỗi cung khả năng thông qua . Ta thêm vào đồ thị hai đỉnh mới  và . Ta nối  với mỗi đỉnh trong  và nối mỗi đỉnh trong  với . Mỗi cung mới thêm vào đều có khả năng thông qua . Gọi  là mạng thu được sau thao tác này. Xem ví dụ trong Figure 1(c). Ta sẽ chứng minh bài toán tìm cặp ghép cực đại của  có thể được quy về bài toán tìm luồng cực đại trong . 
 Gọi  là cặp ghép cực đại của . Ta sẽ chứng minh  có một luồng  với giá trị . Chiều ngược lại của định lý coi như bài tập cho bạn đọc. Ta sẽ chuyển  đơn vị luồng dọc theo các cung sau:Ta gán luồng  cho mọi cung khác của . Gọi  là luồng thu được. Ta có thể dễ dàng kiểm tra được các điều kiện của luồng đối với  (chi tiết coi như bài tập cho bạn đọc). Ngoài ra, có đúng  cung đi ra khỏi  là có luồng khác không vì  kề với đúng  đỉnh trong . Do đó, .  Dễ thấy xây dựng  có thể được thực hiện trong thời gian  Do  có  đỉnh và  cạnh và luồng cực đại trong  có giá trị là , áp dụng thuật toán Ford-Fulkerson, ta có thể tìm luồng cực đại trong  trong thời gian .Cho một ma trận vuông  kích thước  trong đó tổng các phần tử trên mỗi hàng đều là số nguyên và tổng các phần tử trên mỗi cột cũng đều là số nguyên. Tìm một cách làm tròn ma trận , bằng cách làm tròn mỗi phần tử của  thành một số nguyên gần nhất sao cho tổng các hàng và cột của  không thay đổi. Xem ví dụ   Ta sẽ quy bài toán này về bài toán tìm . Ta sẽ xây dựng một đồ thị  từ  như sau: Ban đầu đồ thị của chúng ta rỗng.Mọi cung khác của đồ thị sẽ có định mức là . Figure 3 minh họa cho mạng xây dựng theo cách này từ ma trận ví dụ ở trên.
 mạng thu được từ ma trận ví dụ ở trên.Một luồng cực dại được gọi là  nếu như mọi cung đi ra từ  đều được bão hoàn, i.e,  với mọi . Theo định lý  Ford-Fulkerson, luồng bão hòa cũng là luồng cực đại của đồ thị. Ta có: 
 Ta sẽ phải chứng minh hai chiều của định lý. Chiều đầu tiên, ta sẽ chứng minh một cách làm tròn ma trận  sẽ cho ta một luồng cực đại bão hòa trong . Gọi  là ma trận làm tròn của . Luồng trên các cung của  sẽ có giá trị tương ứng như sau:Dễ thấy luồng trên là một luồng bão hòa vì mọi cung đi ra từ  đều được bão hòa. Ta sẽ kiểm tra luồng định nghĩa như trên là một luồng hợp lệ với định mức cạnh. Theo định nghĩa, mỗi phần tử  chỉ được làm tròn thành số nguyên gần nhất, . Do đó, điều kiện định mức được thỏa mãn. Điều kiện thông qua cũng được thỏa mãn, do . Ta chỉ còn phải kiểm tra điều kiện bảo toàn. Do ma trận làm tròn  bảo toàn tổng hàng và tổng cột, luồng  mỗi  là tổng hàng thứ  của  và cũng chính là tổng hàng thứ  của . Do tổng luồng  từ  là tổng hàng thứ  của , điều kiện bảo toàn được thỏa mãn tại . Chứng minh tương tự với mỗi . Chiều ngược lại, từ một luồng cực đại bão hòa của , ta sẽ xây dựng ma trận làm tròn  cho ma trận  như sau:   Do định mức mà khả năng thông qua của  đều là số nguyên, luồng trên các cung cũng là số nguyên. Do đó, ma trận  là ma trận nguyên. Do tính bảo toàn luồng, tổng hàng và cột trong  cũng được bảo toàn trong . Các tính chất khác cần có của ma trận  cũng có thể dễ dàng được kiểm tra thông qua điều kiện định mức của mạng.Trong bài toán này, đầu vào của chúng ta là một bức ảnh và ta muốn tách một đối tượng (gọi là phân vùng) trong bức ảnh ra khỏi phần khác của bức ảnh mà ta gọi chung là nền. Xem ví dụ trong Figure 4.
 Tách 3 đối tượng (3 cái bút chì) ra khỏi bức ảnh. Phần tối màu đen là nền của bức ảnh. Hình được lấy từ .Để đơn giản, ở đây, ta sẽ chỉ tách một (và chỉ một)  đối tượng; tất cả các đối tượng khác ta đều coi là nền. Để chuyển bài toán này thành một bài toán tính toán cụ thể, ta cần phải mô hình hóa bức ảnh để biến nó thành đồ thị. Bước này cần rất nhiều kiến thức liên quan đến xử lí ảnh, do đó, mình sẽ cố gắng mô tả một cách đơn giản. Chi tiết cụ thể hơn bạn đọc có thể tham khảo tại bài báo gốc [2]. Ta sẽ coi mỗi một điểm ảnh (pixel) là một đỉnh của đồ thị . Mỗi đỉnh  có hai đại lượng:  tương ứng với khả năng điểm  thuộc đối tượng và  tương ứng với khả năng  thuộc nền. Mỗi điểm ảnh  (không thuộc phần biên ảnh) sẽ có 4 điểm ảnh kề bên. Với mỗi điểm ảnh kề bên , ta sẽ có cạnh tương ứng  với trọng số . Trọng số này sẽ tương ứng với  phân  và  vào hai vùng khác nhau, i.e,  thuộc đối tượng và  thuộc nền hoặc ngược lại. Làm thế nào để có được những đại lượng này từ một bức ảnh, xem phần remark ở cuối bài. Ở đây, ta giả sử đã có sẵn những đại lượng như vậy.Ta có hai tiêu chuẩn chính khi thực hiện phân vùng ảnh:Hai tiêu chuẩn đó đưa đến việc tìm một phân hoạch  của tập đỉnh  sao cho  định nghĩa dưới đây đạt giá trị cực đại:  Ta có thể coi tập đỉnh  tương ứng với tập các điểm ảnh của đối tượng và tập đỉnh  là tập các điểm ảnh thuộc nền. Đặt , ta có:  Do  là một hằng số, ta có thể chuyển bài toán cực đại hóa  về bài toán cực tiểu hóa . Ta sẽ quy bài toán này về bài toán tìm một lắt cắt  với trọng số cực tiểu trong đồ thị (khác ).Nhắc lại, đồ thị hiện tại của chúng ta có tập đỉnh là tập các điểm ảnh và hai điểm ảnh kề bên  sẽ được nối với một cạnh với trọng số . Ta sẽ biến mỗi cạnh vô hướng này thành hai cung song song  và  với cùng khả năng thông qua . Ta sẽ thêm vào đồ thị hai đỉnh  và . Với mỗi điểm ảnh , ta  thêm một cung  với trọng số  và một cung  với trọng số . Gọi đồ thị thu được là . Xem minh họa trong Figure 6.
 Mạng thu được trong bài toán phân vùng ảnh.   
 Chú ý, lát cắt  là lát cắt trong đồ thị   còn lát cắt  là lát cắt trong đồ thị  . Theo định nghĩa:  Từ định nghĩa, nếu ta có hai cung song song  và  với cùng khả năng thông qua, ở đây , thì ta chỉ tính khả năng thông qua của cung  trong . Dựa vào định nghĩa của , đại lượng  chính là tổng khả năng thông qua của các cung từ  tới các đỉnh trong  và  chính là khả năng thông qua của các đỉnh từ  tới . Do đó . Theorem 3 cho chúng ta biết, để tìm phân hoạch  của bức ảnh thỏa mãn   cực tiểu, ta chỉ việc tìm một lát cắt  cực tiểu trong đồ thị . Lát cắt này có thể tìm bằng cách tìm một luồng cực đại từ  tới , theo định lý Ford-Fukerson.  Trong phần này, mình sẽ lượt qua ngắn gọn cách thu được  như mô tả ở trên. Về mặt trực quan, đại lượng  đặc trưng cho độ tương tự giữa hai điểm ảnh. Nếu hai điểm ảnh  càng tương tự nhau,  càng lớn, và như vậy, chi phí phân  vào hai vùng khác nhau càng cao. Ví dụ, trong [2], tác giả chọn , với  là một hằng số dương và  là cường độ tại hai điểm ảnh , là một hàm thỏa mãn tiêu chí như vậy. Để thu được  ( ta làm tương tự), ta có thể cố định một số điểm ảnh trên ảnh thuộc đối tượng. Hay nói cách khác, ta chọn một số điểm ảnh và cho  với những điểm ảnh này. Với các điểm ảnh khác, ví dụ , ta  sẽ gán  tỉ lệ với độ tương tự (trung bình) giữa  và các điểm ảnh mà ta đã chọn sẵn thuộc đối tượng. Về mặt trực quan, ta càng cố định nhiều điểm thuộc đối tượng (giả sử các điểm đó đúng là đối tượng), thì khả năng ta gán  cho các điểm ảnh càng chính xác. Figure 5 dưới đây là ví dụ về chất lượng phân vùng sử dụng thuật toán trên với các điểm ảnh chọn thuộc đối tượng khác nhau. 
 Độ chính xác của thuật toán phân vùng khi nhiều điểm được đánh dấu là thuộc đối tượng/nền. Hình lấy từ [2].[1] J. Erickson. , UIUC, Fall 2013.
[2] Y. Boykov and G. Funka-Lea.  International Journal of Computer Vision 70.2 (2006).
[3] K. Wayne.  , Princeton, Spring 2001. , , , , Trackback link: Powered by  and 